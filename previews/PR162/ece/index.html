<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Expected calibration error (ECE) · CalibrationErrors.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://devmotion.github.io/CalibrationErrors.jl/ece/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CalibrationErrors.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">CalibrationErrors.jl</a></li><li><a class="tocitem" href="../introduction/">Introduction</a></li><li class="is-active"><a class="tocitem" href>Expected calibration error (ECE)</a><ul class="internal"><li><a class="tocitem" href="#Definition"><span>Definition</span></a></li><li><a class="tocitem" href="#Estimators"><span>Estimators</span></a></li></ul></li><li><a class="tocitem" href="../kce/">Kernel calibration error (KCE)</a></li><li><a class="tocitem" href="../others/">Other calibration errors</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/classification/">Classification of penguin species</a></li><li><a class="tocitem" href="../examples/distribution/">Distribution of calibration error estimates</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Expected calibration error (ECE)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Expected calibration error (ECE)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/devmotion/CalibrationErrors.jl/blob/main/docs/src/ece.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ece"><a class="docs-heading-anchor" href="#ece">Expected calibration error (ECE)</a><a id="ece-1"></a><a class="docs-heading-anchor-permalink" href="#ece" title="Permalink"></a></h1><h2 id="Definition"><a class="docs-heading-anchor" href="#Definition">Definition</a><a id="Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Definition" title="Permalink"></a></h2><p>A common calibration measure is the so-called expected calibration error (ECE). In its most general form, the ECE with respect to distance measure <span>$d(p, p&#39;)$</span> is defined<sup class="footnote-reference"><a id="citeref-WLZ21" href="#footnote-WLZ21">[WLZ21]</a></sup> as</p><p class="math-container">\[\mathrm{ECE}_d := \mathbb{E} d\big(P_X, \mathrm{law}(Y \,|\, P_X)\big).\]</p><p>As implied by its name, the ECE is the expected distance between the left and right hand side of the calibration definition with respect to <span>$d$</span>.</p><p>Usually, the ECE is used to analyze classification models.<sup class="footnote-reference"><a id="citeref-GPSW17" href="#footnote-GPSW17">[GPSW17]</a></sup><sup class="footnote-reference"><a id="citeref-VWALRS19" href="#footnote-VWALRS19">[VWALRS19]</a></sup> In this case, <span>$P_X$</span> and <span>$\mathrm{law}(Y \,|\, P_X)$</span> can be identified with vectors in the probability simplex and <span>$d$</span> can be chosen as a the cityblock distance, the total variation distance, or the squared Euclidean distance.</p><p>For other probabilistic predictive models such as regression models, one has to choose a more general distance measure <span>$d$</span> between probability distributions on the target space since the conditional distributions <span>$\mathrm{law}(Y \,|\, P_X)$</span> can be arbitrarily complex in general.</p><h2 id="Estimators"><a class="docs-heading-anchor" href="#Estimators">Estimators</a><a id="Estimators-1"></a><a class="docs-heading-anchor-permalink" href="#Estimators" title="Permalink"></a></h2><p>The main challenge in the estimation of the ECE is the estimation of the conditional distribution <span>$\mathrm{law}(Y \,|\, P_X)$</span> from a finite data set of predictions and corresponding targets. Typically, predictions are binned and empirical estimates of the conditional distributions are calculated for each bin. You can construct such estimators with <a href="#CalibrationErrors.ECE"><code>ECE</code></a>.</p><article class="docstring"><header><a class="docstring-binding" id="CalibrationErrors.ECE" href="#CalibrationErrors.ECE"><code>CalibrationErrors.ECE</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ECE(binning[, distance = TotalVariation()])</code></pre><p>Estimator of the expected calibration error (ECE) for a classification model with respect to the given <code>distance</code> function using the <code>binning</code> algorithm.</p><p>For classification models, the predictions <span>$P_{X_i}$</span> and targets <span>$Y_i$</span> are identified with vectors in the probability simplex. The estimator of the ECE is defined as</p><p class="math-container">\[\frac{1}{B} \sum_{i=1}^B d\big(\overline{P}_i, \overline{Y}_i\big),\]</p><p>where <span>$B$</span> is the number of non-empty bins, <span>$d$</span> is the distance function, and <span>$\overline{P}_i$</span> and <span>$\overline{Y}_i$</span> are the average vector of the predictions and the average vector of targets in the <span>$i$</span>th bin. By default, the total variation distance is used.</p><p>The <code>distance</code> has to be a function of the form</p><pre><code class="language-julia hljs">distance(pbar::Vector{&lt;:Real}, ybar::Vector{&lt;:Real}).</code></pre><p>In particular, distance measures of the package <a href="https://github.com/JuliaStats/Distances.jl">Distances.jl</a> are supported.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/devmotion/CalibrationErrors.jl/blob/7374acdbed8e3e0a20f6fbbedb8f1a44c61a355e/src/ece.jl#LL8-L30">source</a></section></article><h3 id="Binning-algorithms"><a class="docs-heading-anchor" href="#Binning-algorithms">Binning algorithms</a><a id="Binning-algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Binning-algorithms" title="Permalink"></a></h3><p>Currently, two binning algorithms are supported. <a href="#CalibrationErrors.UniformBinning"><code>UniformBinning</code></a> is a binning schemes with bins of fixed bins of uniform size whereas <a href="#CalibrationErrors.MedianVarianceBinning"><code>MedianVarianceBinning</code></a> splits the validation data set of predictions and targets dynamically to reduce the variance of the predictions.</p><article class="docstring"><header><a class="docstring-binding" id="CalibrationErrors.UniformBinning" href="#CalibrationErrors.UniformBinning"><code>CalibrationErrors.UniformBinning</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">UniformBinning(nbins::Int)</code></pre><p>Binning scheme of the probability simplex with <code>nbins</code> bins of uniform width for each component.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/devmotion/CalibrationErrors.jl/blob/7374acdbed8e3e0a20f6fbbedb8f1a44c61a355e/src/binning/uniform.jl#LL1-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CalibrationErrors.MedianVarianceBinning" href="#CalibrationErrors.MedianVarianceBinning"><code>CalibrationErrors.MedianVarianceBinning</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MedianVarianceBinning([minsize::Int = 10, maxbins::Int = typemax(Int)])</code></pre><p>Dynamic binning scheme of the probability simplex with at most <code>maxbins</code> bins that each contain at least <code>minsize</code> samples.</p><p>The data set is split recursively as long as it is possible to split the bins while satisfying these conditions. In each step, the bin with the maximum variance of predicted probabilities for any component is selected and split at the median of the predicted probability of the component with the largest variance.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/devmotion/CalibrationErrors.jl/blob/7374acdbed8e3e0a20f6fbbedb8f1a44c61a355e/src/binning/medianvariance.jl#LL1-L11">source</a></section></article><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-GPSW17"><a class="tag is-link" href="#citeref-GPSW17">GPSW17</a>Guo, C., et al. (2017). <a href="http://proceedings.mlr.press/v70/guo17a.html">On calibration of modern neural networks</a>. In <em>Proceedings of the 34th International Conference on Machine Learning</em> (pp. 1321-1330).</li><li class="footnote" id="footnote-VWALRS19"><a class="tag is-link" href="#citeref-VWALRS19">VWALRS19</a>Vaicenavicius, J., et al. (2019). <a href="http://proceedings.mlr.press/v89/vaicenavicius19a.html">Evaluating model calibration in classification</a>. In <em>Proceedings of Machine Learning Research (AISTATS 2019)</em> (pp. 3459-3467).</li><li class="footnote" id="footnote-WLZ21"><a class="tag is-link" href="#citeref-WLZ21">WLZ21</a>Widmann, D., Lindsten, F., &amp; Zachariah, D. (2021). <a href="https://openreview.net/forum?id=-bxf89v3Nx">Calibration tests beyond classification</a>. To be presented at <em>ICLR 2021</em>.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../introduction/">« Introduction</a><a class="docs-footer-nextpage" href="../kce/">Kernel calibration error (KCE) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 4 February 2024 01:21">Sunday 4 February 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
